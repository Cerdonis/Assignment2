clc 
clear
close all

i1 = imread('im1.pgm');
i2 = imread('im2.pgm');
i1 = im2double(i1);
i2 = im2double(i2);

ncc_match = [668,755;235,356;771,678;704,890;927,791;906,730;55,842;815,956;537,275;637,331;885,921;249,773;718,505;532,513;611,131;513,292;595,751;271,917;863,525;938,656;74,202;730,722;979,982;444,377;590,378;129,872;751,435;523,353;954,968;940,458;986,792;698,954;400,287;27,770;224,793;975,841;502,767;363,260;789,257;20,389;507,315;556,580;920,866;404,218;348,797;600,744;226,76;939,457;418,230;604,467;996,813;545,944;740,854;408,676;764,500;710,428;379,915;583,724;876,537;606,994;753,626;31,975;874,697;495,649;842,769;995,709;557,707;638,645;446,536;626,639;150,962;47,40;137,199;998,946;735,804;655,399;949,876;619,969;894,590;572,936;765,714;156,778;676,291;388,285;34,135;257,151;877,932;68,103;714,484;487,658;295,817;352,286;768,402;333,177;562,179;728,814;567,326;406,344;973,662;902,926];
ssd_match = [637,331;668,755;751,435;876,537;979,982;604,467;444,377;996,813;235,356;74,202;430,877;638,645;590,378;730,722;846,161;707,987;249,773;920,866;556,580;698,954;512,466;735,804;222,254;863,525;600,744;740,854;663,638;352,286;267,752;557,707;718,862;753,626;939,457;728,814;804,689;562,179;47,40;408,676;363,260;195,566;137,199;234,490;625,993;396,667;685,998;883,240;954,968;567,326;348,428;378,688;655,797;838,696;709,879;901,875;120,885;255,463;982,599;786,985;842,769;496,484;470,725;253,105;906,917;66,100;696,704;641,470;950,920;782,548;242,488;257,151;957,948;778,195;388,285;772,782;623,989;874,697;524,454;508,526;756,244;424,857;951,482;129,132;472,507;394,164;750,731;495,649;652,380;211,496;986,751;870,844;781,780;632,828;361,740;335,1000;483,320;633,469;962,826;610,448;455,357;553,612];

match = ssd_match;

corners1 = [489,441;488,496;376,359;502,438;492,493;485,508;488,454;485,458;483,496;502,444;486,503;491,446;360,396;480,460;497,491;506,447;494,442;477,418;486,515;376,354;484,441;490,459;483,453;506,435;492,451;481,446;478,413;342,485;376,364;487,449;487,491;335,621;371,358;375,234;479,493;497,534;479,465;487,408;494,688;479,441;489,436;485,520;484,463;399,53;346,478;482,410;257,547;478,498;264,446;319,314;371,363;380,234;496,447;507,442;478,728;459,43;502,534;494,538;492,407;482,512;394,22;510,450;338,617;475,490;511,426;475,468;268,410;365,395;495,683;290,370;319,298;501,488;7,316;249,489;436,45;319,319;316,464;474,440;472,419;554,155;262,547;289,375;347,483;476,445;341,480;621,367;464,43;510,432;499,539;608,44;383,230;282,119;402,49;475,462;335,626;477,733;454,43;269,405;508,510;481,517;519,577;319,97;342,490;482,416;621,372;539,795;501,449;391,350;490,685;265,466;6,321;363,400;482,489;268,443;255,416;515,429;474,495;487,413;515,423;224,528;263,418;252,445;478,450;520,548;394,54;612,41;489,511;611,51;323,295;335,452;483,405;6,307;597,387;388,23;478,455;371,353;508,515;282,92;592,387;511,405;219,530;313,96;473,414;337,486;263,451;520,553;482,725;254,489;557,159;277,119;256,552;302,120;626,368;572,252;275,92;369,422;289,92;511,445;490,541;357,400;316,302;260,443;253,578;331,287;611,56;490,518;260,466;399,23;431,46;286,379;447,41;503,542;606,39;489,403;418,46;514,577;475,409;267,415;511,542;288,119;6,301;511,400;505,485;510,455;396,350;424,48;604,47;507,536;397,48;482,436;320,126;318,293;507,490;345,494;255,411;438,40;520,543;488,524;321,303;519,583;299,359;349,474;337,447;372,238;314,316;490,691;602,388;489,464;376,229;515,548;619,427;496,486;434,19;252,420;118,674;277,461;285,372;534,276;452,749;519,571;517,557;311,464;513,487;472,784;613,46;297,120;380,239;519,592;268,449;480,470;552,160;559,154;544,795;300,354;355,440;330,653;265,461;446,267;250,484;298,93;513,510;572,257;291,365;254,573;229,527;264,440;606,54;283,383;282,754;504,575;496,543;621,362;257,542;332,617;600,383;273,402;261,552;618,519;616,24;344,446;263,412;388,368;411,311;491,501;314,297;625,375;158,493;516,540;624,64;500,529;315,311;247,447;308,95;282,124;620,377;575,261;507,545;562,158;554,150;266,471;535,252;292,122;623,59;337,491;252,440;515,451;387,353;512,537;193,391;601,443;262,423;635,64;315,126;566,246;214,529;469,44;481,421;417,22;612,391;373,368;455,745;336,479;266,435;340,495;287,6;303,95;614,60;634,43;463,18;259,448;514,582;286,367;589,391;603,29;505,530;615,19;514,572;492,412;282,759;289,383;255,484;323,311;293,95;272,119;450,270;519,597;514,553;478,722;612,397;282,376;333,457;199,247;179,222;513,515;548,602;616,373;337,394;482,731;593,453;406,312;264,407;492,533;483,525;616,367;611,412;273,408;282,460;150,498;341,470;605,384;260,401;174,253;220,525;412,301;324,318;509,575;598,447;595,382;118,679;11,313;621,25;431,15;529,274;339,475;340,508;11,321;619,422;397,18;261,471;334,283;619,62;194,248;224,415;532,248;507,505;615,32;316,459;613,418;104,671;608,31;615,462;626,363;224,533;635,59;67,543;474,737;490,696;307,120;521,538;256,469;228,495;11,307;611,384;510,483;286,768;278,456;619,432;433,41;621,30;176,218;348,468;270,94;514,592;491,680;484,400;324,123;346,513;416,17;340,451;265,402;295,356;247,420;459,742;441,44;487,537;615,378;606,25;325,300;397,58;327,755;611,22;630,46;593,447;338,437;610,36;250,415;598,458;374,422;463,736;198,281;259,408;560,163;478,405;516,399;153,494;604,447;505,570;533,232;263,394;502,432;522,558;621,515;495,795;516,404;515,456;402,44;274,540;184,222;391,18;270,462;393,367;385,236;565,75;390,235;605,440;266,544;215,235;277,124;515,91;248,311;335,613;184,533;508,520;616,360;260,461;302,125;516,587;343,441;613,519;348,128;624,427;450,46;287,124;267,421;519,562;511,437;414,307;113,674;408,307;351,372;444,19;212,541;601,24;490,701;496,496;461,12;409,316;615,387;150,277;314,321;328,457;526,598;235,220;548,597;323,100;463,38;614,424;244,489;328,283;437,15;598,453;327,657;338,442;381,355;604,34;121,670;405,53;392,49;335,290;634,49;616,38;179,252;513,492;187,527;630,371;257,439;111,512;611,438;327,290;248,580;468,18;269,399;266,476;517,668;249,316;514,597;457,750;255,464;530,279;271,470;357,392;313,765;198,496;603,457;594,392;266,430;477,784;540,237;375,349;628,59;543,604;609,61;612,532;360,404;352,444;341,513;424,15;145,280;383,368;512,505;372,150;282,453;546,242;635,38;537,247;195,336;63,546;626,30;565,241;547,209;330,624;190,523;298,98;602,42;509,460;553,601;252,547;341,391;330,452;498,691;337,504;485,700;335,651;614,434;363,666;471,465;288,452;183,540;219,467;374,482;480,507;533,237;515,434;449,753;528,269;494,437;516,567;341,465;347,518;518,109;619,465;225,523;285,390;268,457;443,263;230,221;499,686;422,43;629,65;444,14;574,530;536,7;350,493;151,272;610,17;226,28;194,284;479,522;213,466;222,400;340,622;203,279;327,750;6,270;587,386;140,290;304,357;282,6;13,674;617,43;618,57;273,458;141,285;286,457;169,253;109,671;222,420;617,392;348,499;392,59;610,379;194,396;588,424;577,256;515,482;522,567;224,341;392,324;297,125;450,744;513,109;510,421;500,483;364,421;586,395;268,394;232,492;615,524;422,21;616,50;616,411;510,569;234,526;568,535;610,463;588,454;342,614;611,360;334,126;630,40;348,133;345,451;555,164;279,96;219,354;512,558;203,244;18,157;624,432;145,275;483,720;243,417;527,593;189,248;619,67;136,185;617,438;450,631;165,267;570,243;398,367;267,388;274,385;542,204;270,479;479,400;338,456;188,391;388,230;510,549;612,27;567,253;267,539;266,550;473,41;504,580;620,35;14,669;349,281;635,54;486,544;274,465;275,473;609,536;616,529;405,632;588,418;354,396;206,470;592,506;307,125;590,461;509,580;468,39;590,382;614,429;620,460;395,328;618,382;249,494;404,367;26,505;633,462;263,480;192,528;542,209;599,392;529,264;325,128;412,296;334,466;535,281;540,608;621,523;513,395;495,649;199,252;598,28;635,367;570,262;202,284;395,63;505,550;343,436;68,538;251,450;518,602;7,326;190,254;184,250;134,136;547,204;560,231;529,244;114,508;271,439;322,290;244,314;342,536;547,566;191,333;345,508;188,510;226,33;341,125;332,447;368,367;311,459;212,231;104,676;472,789;624,465;467,13;635,69;343,499;360,670;285,96;280,40;416,312;237,215;588,447;553,596;68,548;290,765;410,632;521,665;247,442;512,95;530,253;282,394;564,153;177,257;547,607;441,630;261,428;606,20;139,189;174,223;254,568;493,400;322,323;374,477;464,741;519,426;354,352;515,104;163,310;320,467;615,536;598,439;272,413;350,377;388,240;225,573;179,742;481,502;370,348;560,74;543,7;500,795;290,390;628,35;451,38;585,462;273,396;113,679;155,499;608,388;485,695;6,682;542,245;336,461;458,737;621,40;257,421;333,475;580,261;620,20;475,633;323,94;367,669;417,301;629,465;620,357;275,452;549,156;587,467;325,652;521,227;6,275;6,296;185,255;333,483;191,339;369,473;193,514;344,281;599,33;234,413;565,70;396,27;258,576;481,192;346,532;6,284;629,51;516,446;513,602;514,672;207,465;341,130;443,271;469,633;368,417;372,456;471,444;414,249;617,397;454,12;618,417;99,525;335,509;227,411;382,350;116,513;499,680;589,399;267,118;293,117;464,245;626,43;605,276;193,497;626,69;217,542;616,514;338,399;360,440;601,288;390,363;543,599;404,24;378,369;189,532;272,390;181,217;614,442;545,99;478,218;522,587;353,403;530,228;337,499;129,337;251,552;635,80;449,12;11,302;279,386;562,236;179,533;473,47;462,48;541,544;490,795;517,535;350,450;222,395;141,184;303,100;511,586;7,636;258,453;367,150;294,90;605,379;438,22;289,735;355,369;222,25;135,180;126,686;625,358;355,375;415,42;347,30;522,92;508,500;444,37;517,96;615,14;625,460;477,514;363,51;630,376;540,11;384,26;150,282;172,258;429,795;276,535;617,341;272,124;445,633;611,527;234,424;542,252;573,535;508,396;383,225;281,768;198,391;271,536;536,228;402,19;449,19;233,497;334,131;198,340;597,504;353,128;521,671;607,541;214,356;486,688;294,736;160,314;342,396;287,395;187,543;559,149;506,243;536,579;348,463;372,427;134,141;615,468;168,486;60,590;623,154];
corners2 = [474,510;477,506;491,466;473,515;488,474;496,468;504,468;482,475;487,469;492,471;489,445;504,474;473,503;509,466;469,518;469,512;495,463;491,440;482,470;478,478;354,450;413,370;392,392;478,501;488,479;488,462;499,439;475,482;358,447;509,474;333,354;391,414;473,498;496,474;483,480;505,463;484,445;353,455;480,510;268,473;318,547;484,465;513,463;496,506;631,266;505,439;515,129;414,365;468,503;495,443;337,351;359,452;315,551;519,103;475,536;468,498;472,522;273,473;372,318;378,305;501,506;477,473;409,367;502,443;351,460;298,399;631,271;329,357;480,538;291,419;500,471;518,461;349,451;491,553;389,396;357,425;486,440;520,129;552,136;356,460;495,436;353,445;438,682;425,719;514,468;523,106;408,372;377,310;363,449;496,511;492,525;486,457;375,322;336,431;420,757;573,140;450,272;511,132;302,567;481,461;479,533;500,465;396,414;278,472;267,468;87,218;507,479;486,544;471,533;87,224;465,515;471,539;422,723;71,221;466,522;420,752;514,103;392,419;333,360;245,342;412,375;491,516;46,413;565,138;492,459;519,466;433,683;373,305;578,141;295,403;361,422;383,304;218,429;557,134;445,272;314,544;537,133;473,477;480,543;322,544;264,476;300,417;422,747;298,394;396,389;90,228;394,397;291,414;441,678;428,723;271,478;356,441;71,216;494,520;479,466;489,521;511,743;485,538;68,225;275,433;626,267;453,612;603,462;501,501;634,275;508,56;492,548;377,317;329,351;547,135;337,357;501,511;486,554;304,379;348,456;43,417;270,203;489,558;215,436;369,322;512,478;95,228;413,751;320,552;516,134;597,461;483,573;496,501;92,218;569,562;419,719;354,429;76,218;584,336;590,534;436,687;442,650;212,440;521,444;510,483;126,524;272,429;305,417;450,277;500,434;390,151;418,368;508,747;628,455;221,433;365,425;390,127;431,719;429,144;92,223;424,742;425,758;450,644;419,727;300,404;91,188;71,229;635,263;445,646;90,179;417,373;293,398;83,227;83,221;382,309;107,414;526,102;282,233;542,134;300,382;618,349;348,473;469,526;482,504;271,364;575,358;121,86;434,712;303,399;479,576;333,348;84,214;363,444;415,756;74,212;95,214;300,387;504,750;331,431;390,298;430,687;364,418;558,110;472,565;573,353;383,149;612,472;96,188;487,549;437,650;562,560;479,581;418,695;308,376;318,541;395,129;296,420;626,272;286,419;422,689;425,737;410,362;425,753;492,482;283,471;36,117;484,568;347,463;309,414;570,136;257,227;267,199;307,565;388,371;295,408;360,429;454,641;470,481;123,520;487,501;326,361;601,457;608,462;213,428;275,468;396,154;525,441;501,321;479,570;418,732;575,145;336,426;241,339;590,539;588,339;293,376;348,446;555,584;380,300;482,50;406,158;453,617;488,528;325,354;241,680;268,358;427,708;461,337;504,744;277,233;263,471;271,436;615,468;245,629;88,184;284,310;257,494;507,61;388,389;588,504;432,726;16,342;485,561;96,233;495,544;230,238;290,424;207,441;560,115;541,110;422,167;91,211;629,450;587,548;347,347;475,542;98,218;358,418;426,714;635,379;375,424;515,740;299,377;574,562;521,457;303,394;440,645;457,609;586,118;347,468;625,459;424,55;372,310;102,414;407,27;408,751;71,139;482,548;455,272;45,234;85,195;526,446;611,216;94,202;477,564;402,130;268,368;458,341;614,463;435,655;363,439;497,524;64,213;477,50;281,228;305,372;120,524;97,193;505,484;505,324;278,429;634,385;276,477;520,738;543,56;428,733;309,420;555,275;514,458;608,308;449,639;435,707;263,714;385,299;550,584;296,414;631,459;580,339;91,194;423,694;47,224;524,43;85,65;129,520;74,198;106,419;580,361;65,197;90,233;93,183;614,346;309,293;62,591;571,301;391,303;306,570;596,456;581,506;223,428;248,119;285,394;286,414;424,143;48,418;582,144;388,376;288,378;411,22;409,134;476,585;313,411;583,561;268,353;121,91;440,701;594,328;98,224;75,224;258,706;465,494;276,228;393,372;427,747;240,344;407,377;521,134;393,385;606,457;547,109;585,329;262,227;234,235;290,394;557,560;607,213;46,408;275,203;95,208;312,302;556,139;435,678;274,368;592,461;552,29;430,704;65,221;246,682;124,82;553,131;204,445;593,530;39,211;618,354;581,570;348,342;386,124;417,761;588,322;422,762;301,572;609,495;425,727;419,743;246,337;416,723;477,547;612,211;32,120;633,454;560,712;90,205;568,142;309,298;439,710;581,332;609,483;48,230;72,119;290,409;410,756;623,453;101,189;417,748;490,435;548,57;484,533;259,489;503,58;84,189;552,271;510,127;310,371;562,134;164,587;72,134;225,239;492,449;521,438;614,341;89,81;540,129;463,499;514,473;371,384;414,729;397,419;350,441;286,230;474,570;474,560;41,412;355,434;534,730;488,565;568,557;445,701;490,541;584,501;427,691;265,204;411,158;619,463;210,435;606,207;435,702;612,6;544,292;497,516;375,300;308,382;296,372;19,482;587,530;367,317;519,743;84,200;38,417;593,503;556,579;416,737;305,365;69,211;441,686;589,122;258,298;59,213;572,588;401,156;290,402;523,125;573,593;509,752;322,526;615,201;43,80;100,213;15,347;528,107;390,156;591,335;353,473;467,536;422,379;256,701;420,140;618,472;330,364;590,544;100,229;379,146;498,317;37,112;36,207;399,385;331,426;249,403;598,334;474,580;455,277;127,504;42,224;94,82;585,509;569,116;533,18;66,192;126,87;60,670;285,399;413,137;612,328;404,135;412,746;247,234;395,300;287,428;444,674;515,6;295,425;608,500;350,432;381,459;629,276;118,519;573,348;558,315;392,36;359,464;619,359;436,348;475,530;415,19;462,519;433,147;484,578;590,499;481,55;279,436;123,528;360,457;257,611;93,175;456,346;437,697;379,325;505,434;280,467;442,706;629,386;534,129;365,430;304,412;496,431;280,313;45,219;515,482;75,377;399,356;613,351;567,298;542,105;325,366;417,690;394,295;281,375;89,200;460,38;289,373;486,35;60,196;246,634;97,198;606,487;523,462;79,214;421,714;311,548;440,272;413,741;611,458;242,685;391,409;588,513;573,306;276,363;36,215;477,458;253,230;469,569;466,21;110,410;101,419;414,698;430,738;433,691;554,107;578,600;259,711;454,34;299,227;295,381;72,207;230,243;423,732;63,207;464,506;461,332;217,441;453,636;448,179;59,595;522,99;551,579;85,60;272,198;268,227;232,272;272,234;565,293;575,114;79,230;547,296;560,320;602,503;253,705;74,193;458,614;252,496;605,304;479,485;227,419;619,343;21,312;610,490;417,166;259,616;192,407;494,557;235,240;139,101;300,423;350,426;254,295;539,290;324,549;441,175;274,375;76,716;486,484;620,458;520,40;472,48;408,743;466,336;425,685;464,341;37,202;244,621;587,144;42,230;630,379;77,208;28,258;576,584;579,501;40,219;243,401;432,697;208,448;461,17;344,459;482,32;499,447;301,369;402,28;458,636;252,610;84,80;327,545;75,203;289,311;187,408;11,342;252,426;586,570;464,41;308,409;472,25;526,436;393,377;385,393;578,595;474,575;227,234;555,33;585,535;562,555;248,124;576,344;85,232;502,63;435,722;407,163;263,708;282,476;632,392;496,551;90,65;392,366;235,268;14,707;424,50;245,347;578,565;427,379;577,329;306,360;394,124;422,708;629,445;537,21;314,293;596,298;275,425;476,55;529,44;556,715;240,629;81,716;416,378;513,748;395,40;582,513;372,326;96,179;541,255;42,422;396,159;614,357;354,465;24,481;361,414;68,143;80,194;522,346;99,203;439,352;21,341;28,466;343,471;613,333;412,734;342,465;593,341;241,675;20,466;516,735;444,641;591,318;538,733;617,328;273,256;596,303;238,401;82,209;281,419;316,287;583,556;67,119;242,451;386,35;229,277;427,168;263,719;455,646;583,114;481,553;507,740;299,222;573,557;635,217;558,279;455,39;300,409;265,372;419,55;434,310;18,352;425,703;343,342;606,218;387,294;79,273;577,579;87,175;36,123;406,22;404,369;99,184;114,516;522,449;487,50;404,356;250,630;613,206;547,741;440,655;125,95;267,481;267,428;200,279;610,467;41,206;297,364;604,495;83,184;535,275;524,741;573,598;618,338;524,735;477,590;44,239;245,352;243,120;71,234;238,447;478,29;370,424;613,498;436,717;424,34;509,103;593,548;385,399;316,415;240,158;36,691;40,489;406,32;164,582;376,383;581,326;568,349;78,381;583,365;353,422;563,111;442,696;308,552;257,427;31,115;481,119;615,10;507,46;58,207;599,294;481,586;523,309;433,733;453,342;50,235;403,374;513,56;281,414;451,267;261,302;79,199;607,6;246,688;301,352;584,481;529,15;313,539;547,407;295,390;433,7;253,224;325,522;412,27;476,555;61,218;292,429;566,328;539,728];

r = randperm(100);
rand_match = r.';
rand_match = [rand_match, rand_match];

% Shuffle the putative matches
for i = 1:100
   rand_match(i,:) =  match(rand_match(i,1), :);    
end

top_four1 = zeros(4,2);
top_four2 = zeros(4,2);

% Aquire randomly selected 4 match pairs
for i = 1:4
   top_four1(i,:) = corners1(rand_match(i,1), :);   
   top_four2(i,:) = corners2(rand_match(i,2), :);   
end

x1=top_four1(1,1); y1=top_four1(1,2);
x2=top_four1(2,1); y2=top_four1(2,2);
x3=top_four1(3,1); y3=top_four1(3,2);
x4=top_four1(4,1); y4=top_four1(4,2);

u1=top_four2(1,1); v1=top_four2(1,2);
u2=top_four2(2,1); v2=top_four2(2,2);
u3=top_four2(3,1); v3=top_four2(3,2);
u4=top_four2(4,1); v4=top_four2(4,2);


% x1  = 185; y1=136; u1  = 158; v1=240;
% x2 = 336; y2 =195; u2 = 298; v2 =258;
% x3  = 359; y3=376; u3  = 370; v3=413;
% x4 = 150;  y4=372; u4 = 204;  v4=464;

%%%%%%%%%%%%%%%%%%%% Estimating Affine
% X=[
% x1 y1 0 0 1 0;
% 0 0 x1 y1 0 1;
% x2 y2 0 0 1 0;
% 0 0 x2 y2 0 1;
% x3 y3 0 0 1 0;
% 0 0 x3 y3 0 1];
% 
% a = [u1; v1; u2; v2; u3; v3];
% 
% Aff = X\a;
% Aff = [Aff(1:3,1),Aff(4:6,1)];
% 
% tf = affine2d(Aff);
% i1_aff = imwarp(i1, tf);
% 
% w1 = transformPointsForward(tf, [x1 y1]);
% w2 = transformPointsForward(tf, [x2 y2]);
% ref_dist = norm([u1 v1]-[u2 v2]);
% warp_dist = norm(w1-w2);
% 
% i1_aff = imresize( i1_aff , ref_dist/warp_dist );
% 
% figure; imshow(i1_aff);

%%%%%%%%%%%%%%%%%%%% Estimating homography
A=[
0    0    0  x1   y1  1   -x1*v1   -y1*v1   -v1;
x1  y1  1   0    0    0   -x1*u1   -y1*u1   -u1;
0    0    0  x2   y2  1   -x2*v2   -y2*v2   -v2;
x2  y2  1   0    0    0   -x2*u2   -y2*u2   -u2;
0    0    0  x3   y3  1   -x3*v3   -y3*v3   -v3;
x3  y3  1   0    0    0   -x3*u3   -y3*u3   -u3;
0    0    0  x4  y4  1   -x4*v4   -y4*v4   -v4;
x4  y4  1  0    0    0   -x4*u4   -y4*u4   -u4];

[U,S,V] = svd(A);
 
H = V(:,end);
H = [H(1:3, :), H(4:6, :), H(7:9, :)];

tf = projective2d(H);
i1_homo = imwarp(i1, tf);
% Determine image scale after warping
w1 = transformPointsForward(tf, [x1 y1]);
w2 = transformPointsForward(tf, [x2 y2]);
ref_dist = norm([u1 v1]-[u2 v2]);
warp_dist = norm(w1-w2);

i1_homo = imresize( i1_homo , ref_dist/warp_dist );
figure; imshow(i1_homo);



